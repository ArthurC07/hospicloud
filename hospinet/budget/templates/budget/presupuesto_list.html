{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
    {% load crispy_forms_tags %}
    <div class="row">
        <div class="col-md-12 main-content">
            <ul class="nav nav-tabs">
                <li class="active" role="presentation">
                    <a data-toggle="tab" href="#presupuesto">
                        Presupuesto Financiero
                    </a>
                </li>
                <li role="presentation">
                    <a data-toggle="tab" href="#punto-equilibrio">
                        Ingresos y Egresos
                    </a>
                </li>
                <li role="presentation">
                    <a data-toggle="tab" href="#inversion">
                        Inversi&oacute;n
                    </a>
                </li>
                <li role="presentation">
                    <a data-toggle="tab" href="#ingresos">
                        Ingresos
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="row tab-pane fade in active" id="presupuesto">
                    <section class="col-md-12">
                        <div class="row">
                            <article class="col-md-12">
                                <div class="row">
                                    <div class="col-md-3 col-xs-3">
                                        <h2>Presupuesto Global</h2>
                                    </div>
                                    <div class="col-md-3 col-xs-3">
                                        <h3>
                                            Presupuestado: {{ presupuesto }}</h3>
                                    </div>
                                    <div class="col-md-3 col-xs-3">
                                        <h3>
                                            Ejecutado: {{ gastos }}</h3>
                                    </div>
                                    <div class="col-md-3 col-xs-3">
                                        <h3>Monto Disponible: {{ disponible }}</h3>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="progress">
                                            {% with porcentaje as ejecutado %}
                                                <div class="progress-bar {% if ejecutado >= 100 %} progress-bar-danger {% endif %}"
                                                     role="progressbar"
                                                     aria-valuenow="{% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"
                                                     style="width: {% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}%; min-width: 3em;">
                                                    {{ ejecutado|floatformat:2 }}%
                                                </div>
                                            {% endwith %}
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                        <div class="row">
                            {% for presupuesto in presupuestos.all %}
                                <article class="col-md-6 col-xs-6">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <span class="lead">{{ presupuesto }}
                                            </span>
                                        </div>
                                        <div class="panel-body ">
                                            <div class="row">
                                                <div class="col-md-12 col-xs-12">
                                                    <dl class="dl-horizontal">
                                                        <dt>Presupuestado</dt>
                                                        <dd>{{ presupuesto.total_presupuestado }}</dd>
                                                        <dt>Ejecutado</dt>
                                                        <dd>{{ presupuesto.total_gastos_mes_actual }}</dd>
                                                        <dt>Total de Ingresos</dt>
                                                        <dd>{{ presupuesto.ingresos_mes_actual }}</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="progress">
                                                        {% with presupuesto.porcentaje_ejecutado_mes_actual as ejecutado %}
                                                            <div class="progress-bar {% if ejecutado >= 100 %} progress-bar-danger {% endif %}"
                                                                 role="progressbar"
                                                                 aria-valuenow="{% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}"
                                                                 aria-valuemin="0"
                                                                 aria-valuemax="100"
                                                                 style="width: {% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}%; min-width: 3em;">
                                                                {{ ejecutado|floatformat:2 }}%
                                                            </div>
                                                        {% endwith %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-footer">
                                            <a class="btn btn-primary"
                                               href="{% url 'budget-control' presupuesto.id %}">Ver
                                                Control Presupuestal</a>
                                        </div>
                                    </div>
                                </article>
                            {% empty %}
                                <h3>No hay Presupuestos Disponibles</h3>
                            {% endfor %}
                        </div>
                    </section>
                </div>
                <div class="row tab-pane fade in" id="punto-equilibrio">
                    <div class="col-md-12">
                        <h2>Punto de Equilibrio</h2>
                        <table class="table table-hover table-striped">
                            <thead>
                            <tr>
                                <th>Presupuesto</th>
                                <th>Proyectado</th>
                                <th>Monto Disponible</th>
                                <th>Ingresos</th>
                                <th>Ganacia o P&eacute;rdida del Periodo</th>
                                <th>Egresos</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>Presupuesto Global</td>
                                <td class="text-right">{{ presupuesto }}</td>
                                <td class="text-right">{{ disponible }}</td>
                                <td class="text-right">{{ total_ingresos }}</td>
                                <td class="text-right">{{ balance }}</td>
                                <td class="text-right">{{ gastos }}</td>
                            </tr>
                            {% for presupuesto in presupuestos.all %}
                                {% with presupuesto.get_equilibiio as balance %}
                                    <tr class="{% if balance < 0 %}danger{% endif %}{% if balance > 0 %}success{% endif %}">
                                        <td>{{ presupuesto }}</td>
                                        <td class="text-right">{{ presupuesto.total_presupuestado }}</td>
                                        <td class="text-right">{{ presupuesto.ingresos_mes_anterior }}</td>
                                        <td class="text-right">{{ presupuesto.ingresos_mes_actual }}</td>
                                        <td class="text-right">{{ balance }}</td>
                                        <td class="text-right">{{ presupuesto.total_gastos_mes_actual }}</td>
                                    </tr>
                                {% endwith %}
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row tab-pane fade in" id="inversion">
                    {% for presupuesto in inversiones.all %}
                        <article class="col-md-6 col-xs-6">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                            <span class="lead">{{ presupuesto }}
                                            </span>
                                </div>
                                <div class="panel-body ">
                                    <div class="row">
                                        <div class="col-md-12 col-xs-12">
                                            <dl class="dl-horizontal">
                                                <dt>Presupuestado</dt>
                                                <dd>{{ presupuesto.total_presupuestado }}</dd>
                                                <dt>Ejecutado</dt>
                                                <dd>{{ presupuesto.total_gastos_mes_actual }}</dd>
                                                <dt>Total de Ingresos</dt>
                                                <dd>{{ presupuesto.ingresos_mes_actual }}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="progress">
                                                {% with presupuesto.porcentaje_ejecutado_mes_actual as ejecutado %}
                                                    <div class="progress-bar {% if ejecutado >= 100 %} progress-bar-danger {% endif %}"
                                                         role="progressbar"
                                                         aria-valuenow="{% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100"
                                                         style="width: {% if ejecutado >= 100 %}100{% else %}{{ ejecutado|floatformat:2 }}{% endif %}%; min-width: 3em;">
                                                        {{ ejecutado|floatformat:2 }}%
                                                    </div>
                                                {% endwith %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-footer">
                                    <a class="btn btn-primary"
                                       href="{{ presupuesto.get_absolute_url }}">Ver
                                        Detalle de Presupuesto</a>
                                    <a class="btn btn-primary"
                                       href="{% url 'budget-control' presupuesto.id %}">Ver
                                        Control Presupuestal</a>
                                </div>
                            </div>
                        </article>
                    {% empty %}
                        <div class="col-md-12 col-xs-12">
                            <h3>No hay Presupuestos Disponibles</h3>
                        </div>
                    {% endfor %}
                </div>
                <div class="row tab-pane fade in" id="ingresos">
                    <div class="col-md-12">
                        <h2>Ingresos</h2>
                        <table class="table table-hover table-striped">
                            <thead>
                            <tr>
                                <th>Ciudad</th>
                                <th>Proyectado</th>
                                <th>Ingresado</th>
                                <th>Reembolsado</th>
                                <th>Pendiente de Reembolso</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for income in incomes %}
                                <tr>
                                    <td>{{ income.ciudad }}</td>
                                    <td>{{ income.monto }}</td>
                                    <td>{{ income.ingresado_mes_actual }}</td>
                                    <td>{{ income.total_pagos_reembolsados_mes_actual }}</td>
                                    <td>{{ income.total_pago_por_reembolsar_mes_actual }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
